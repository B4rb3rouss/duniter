#!/usr/bin/env node
"use strict";

var directory = require('../app/lib/directory');
var path = require('path');
var Tail = require('always-tail');
var fs = require('fs');
var util = require('util');

var daemon = require("daemonize2").setup({
  main: "ucoind",
  name: directory.INSTANCE_NAME,
  pidfile: path.join(directory.INSTANCE_HOME, "app.pid")
});

switch (process.argv[2]) {

  case "start":
    daemon.start();
    break;

  case "stop":
    daemon.stop();
    break;

  case "logs":
    let stats = fs.statSync(directory.INSTANCE_HOMELOG_FILE);
    let fileSizeInBytes = stats.size;
    let lastLines = 0.995 * fileSizeInBytes;
    var tail = new Tail(directory.INSTANCE_HOMELOG_FILE, '\n', {
      interval: 5,
      start: Math.max(0, lastLines)
    });
    tail.on("line", function(data) {
      console.log(data);
    });
    break;

  case "restart":
    daemon.stop(function(err) {
      err && console.error(err);
      daemon.start();
    });
    break;

  default:
    console.log("Usage: [start|stop|restart]");
}
